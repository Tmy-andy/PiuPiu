{% extends "base.html" %}
{% block title %}Blacklist{% endblock %}
{% block content %}

<div class="container mt-4">
    <h3 class="mb-4"><i class="fas fa-ban text-danger me-2"></i> Danh sách Blacklist</h3>

    {% if user.role == 'admin' %}
    <form method="get" class="mb-3">
        <div class="row g-2 align-items-center">
            <div class="col-auto">
                <label class="col-form-label">Lọc theo người nhập:</label>
            </div>
            <div class="col-auto">
                <select name="role" class="form-select" onchange="this.form.submit()">
                    <option value="">Tất cả</option>
                    <option value="admin" {% if role_filter == 'admin' %}selected{% endif %}>Chỉ Admin</option>
                    <option value="member" {% if role_filter == 'member' %}selected{% endif %}>Chỉ Member</option>
                </select>
            </div>
        </div>
    </form>
    {% endif %}

    <form method="POST" action="{{ url_for('add_blacklist') }}" class="mb-4">
        <div class="row g-2">
            <div class="col-md-4">
                <input name="name" class="form-control" placeholder="Tên *" required>
            </div>
            <div class="col-md-5">
                <input name="facebook_link" class="form-control" placeholder="Link Facebook">
            </div>
            <div class="col-md-3">
                <button class="btn btn-danger w-100" type="submit">Thêm vào danh sách</button>
            </div>
        </div>
    </form>

    <table class="table table-bordered table-hover">
        <thead>
            <tr>
                <th>Tên</th>
                <th>Facebook</th>
                {% if user.role == 'admin' %}
                <th>Người nhập</th>
                {% endif %}
                <th>Hành động</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in entries %}
            <tr>
                <td>{{ entry.name }}</td>
                <td>
                    {% if entry.facebook_link %}
                        <a href="{{ entry.facebook_link }}" target="_blank">{{ entry.facebook_link }}</a>
                    {% endif %}
                </td>
                {% if user.role == 'admin' %}
                <td>
                    {{ entry.created_by.display_name }}
                    {% if user.member_id == 'ADMIN-001' %}
                    <form method="POST" action="{{ url_for('edit_blacklist_author', entry_id=entry.id) }}" class="mt-1 d-flex align-items-center">
                        <select name="new_user_id" class="form-select form-select-sm me-2" required>
                            {% for u in all_users %}
                                <option value="{{ u.id }}" {% if u.id == entry.created_by_id %}selected{% endif %}>{{ u.display_name }} ({{ u.role }})</option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-sm btn-outline-primary">Cập nhật</button>
                    </form>
                    {% endif %}
                </td>
                {% endif %}
                <td>
                    {% if user.id == entry.created_by_id or user.member_id == 'ADMIN-001' %}
                    <form method="POST" action="{{ url_for('delete_blacklist', entry_id=entry.id) }}" style="display:inline;">
                        <button class="btn btn-sm btn-outline-danger" onclick="return confirm('Bạn chắc chắn?')">Xoá</button>
                    </form>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}
